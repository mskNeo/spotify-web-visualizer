(this["webpackJsonpspotify-web-visualizer"]=this["webpackJsonpspotify-web-visualizer"]||[]).push([[0],{107:function(t,e,c){},110:function(t,e,c){},113:function(t,e,c){"use strict";c.r(e);var n=c(0),a=c(36),r=c.n(a),s=c(6),i=c(115),o=c(1),u=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CLIENT_ID:"5df20bbf39b1459d83e0182097b39224",REACT_APP_CLIENT_SECRET:"2bb8612bb373402db7eb1b2eb04b2b1e",REACT_APP_REDIRECT_URI:"http://localhost:3000"}),l=u.REACT_APP_CLIENT_ID,f=u.REACT_APP_REDIRECT_URI,b=["user-read-email","user-read-private","user-library-read","user-read-playback-state"],d="https://accounts.spotify.com/authorize?client_id=".concat(l,"&response_type=code&redirect_uri=").concat(f,"&show_dialog=true&scope=streaming");function h(){for(var t=0;t<b.length;t++)d+="%20".concat(b[t]);return Object(o.jsx)(i.a,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"100vh"},children:Object(o.jsx)("a",{className:"btn btn-success btn-lg",href:d,children:"Login With Spotify"})})}var j=c(117),p=c(37),O=c.n(p),m=c(19),v=c.n(m);function x(t){var e=t.track,c=t.chooseTrack,a=Object(n.useState)("#fff"),r=Object(s.a)(a,2),i=r[0],u=r[1];return Object(o.jsxs)("div",{className:"d-flex m-2 p-2 align-items-center",style:{cursor:"pointer",background:i},onMouseEnter:function(){return u("#ccc")},onMouseLeave:function(){return u("#fff")},onClick:function(){c(e)},children:[Object(o.jsx)("img",{src:e.albumUrl,style:{height:"64px",width:"64px"},alt:"".concat(e.title," album cover")}),Object(o.jsxs)("div",{className:"px-3",children:[Object(o.jsx)("div",{children:e.title}),Object(o.jsx)("div",{className:"text-muted",children:e.artist})]})]})}var g=c(46);function y(t){var e=t.accessToken,c=t.trackUri,a=t.setTrackStatus,r=Object(n.useState)(!1),i=Object(s.a)(r,2),u=i[0],l=i[1];return Object(n.useEffect)((function(){l(!!c)}),[c]),e?Object(o.jsx)(g.a,{token:e,callback:function(t){a(t.isPlaying),t.isPlaying||l(!1)},play:u,uris:c?[c]:[],styles:{height:50}}):null}var k=c(116),T=c(21);function w(t){var e=t.dim,c=t.x,n=t.y,a=t.color,r=t.className,s=(t.scaledDim,t.opacity);switch(r.split(" ")[0]){case"line":return Object(o.jsx)("div",{className:r,style:{height:"".concat(10,"px"),width:"".concat(4*e*Math.sin(n/c),"px"),top:"".concat(n,"px"),left:"".concat(c,"px"),opacity:s,background:"rgb(".concat(a[0],", ").concat(a[1],", ").concat(a[2],")")}});case"image":return Object(o.jsx)("div",{className:r,style:{height:"".concat(e,"px"),width:"".concat(e,"px"),top:"".concat(n,"px"),left:"".concat(c,"px"),opacity:s},children:Object(o.jsx)("img",{src:"https://picsum.photos/".concat(e,".webp"),alt:"random pic from API",style:{height:"100%",width:"100%"},type:"image/webp"})});default:return Object(o.jsx)("div",{className:r,style:{height:"".concat(e,"px"),width:"".concat(e,"px"),top:"".concat(n,"px"),left:"".concat(c,"px"),opacity:s,background:"rgb(".concat(a[0],", ").concat(a[1],", ").concat(a[2],")"),mixBlendMode:"difference"}})}}c(107);function E(t){var e=t.trackAnalysis,c=(t.trackFeatures,t.playing),a=t.setTimings,r=Object(n.useState)([]),i=Object(s.a)(r,2),u=i[0],l=i[1],f=Object(n.useState)([]),b=Object(s.a)(f,2),d=b[0],h=b[1],j=Object(n.useRef)(0),p=Object(n.useRef)(0),O=Object(n.useRef)(100),m={"":.4,circle:.3,line:.1,image:.2},v={"":.2,deg60:.3,deg45:.2,deg30:.3},x=function(t,e){return Math.floor((c=Math.abs(t-e),(-.022*Math.pow(c-115.766,2)+296.933)*window.innerHeight/100))+10;var c},g=function(t){var e=[];for(var c in t)for(var n=0;n<10*t[c];n++)e.push(c);return function(){return e[Math.floor(Math.random()*e.length)]}},y=Object(n.useCallback)((function(t,e){var c=x(t.loudness_max,t.loudness_start),n=function(t){return Math.random()*(window.innerWidth-t)}(c),a=function(t,e){return(window.innerHeight-e)/12*t}(t.pitches.indexOf(1),c),r=[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],s=g(m),i=g(v),o={dim:c,x:n,y:a,color:r,classes:"".concat(s()," ").concat(i()),scaledDim:1.3*Math.random()*c+.7*c,opacity:t.confidence-.1};l((function(t){return t[e]=o,Object(T.a)(t)}))}),[]);return Object(n.useEffect)((function(){for(var t=0;t<12;t++)l(u.concat({dim:0,x:0,y:0,color:[0,0,0],classes:""}))}),[]),Object(n.useEffect)((function(){e&&h(e.segments.filter((function(t){return t.confidence>.2})))}),[e]),Object(n.useEffect)((function(){c&&d.map((function(t){var e=function(t){return Math.abs(t.loudness_max-t.loudness_start)}(t);e>p.current&&(p.current=e),e<O.current&&(O.current=e);var c=setTimeout((function(){j.current=(j.current+1)%12,y(t,j.current),console.log(t)}),1e3*t.start);return a((function(t){return[].concat(Object(T.a)(t),[c])})),function(){setTimeout(c)}}))}),[c]),Object(o.jsx)("div",{className:"visualizerSpace",children:u.map((function(t,e){var c=t.dim,n=t.x,a=t.y,r=t.color,s=t.classes,i=t.scaledDim,u=t.opacity;return Object(o.jsx)(w,{dim:c,x:n,y:a,color:r,scaledDim:i,opacity:u,className:s},e)}))})}function S(t){var e=t.accessToken,c=t.playingTrack,a=t.trackAnalysis,r=t.trackFeatures,i=t.deselectTrack,u=t.setTimings,l=Object(n.useState)(!1),f=Object(s.a)(l,2),b=f[0],d=f[1],h=Object(n.useCallback)((function(t){d(t)}),[]);if(c)return Object(o.jsxs)("div",{children:[Object(o.jsx)(k.a,{onClick:i,style:{cursor:"pointer",width:"30px",height:"30px"}}),Object(o.jsx)(E,{accessToken:e,trackUri:null===c||void 0===c?void 0:c.uri,trackAnalysis:a,trackFeatures:r,playing:b,setTimings:u}),Object(o.jsx)(y,{accessToken:e,trackUri:null===c||void 0===c?void 0:c.uri,setTrackStatus:h})]})}c(110);var _=new O.a({clientId:"5df20bbf39b1459d83e0182097b39224"});function A(t){var e=function(t){var e=Object(n.useState)(),c=Object(s.a)(e,2),a=c[0],r=c[1],i=Object(n.useState)(),o=Object(s.a)(i,2),u=o[0],l=o[1],f=Object(n.useState)(),b=Object(s.a)(f,2),d=b[0],h=b[1];return Object(n.useEffect)((function(){v.a.post("http://localhost:3001/login",{code:t}).then((function(t){r(t.data.accessToken),l(t.data.refreshToken),h(t.data.expiresIn),window.history.pushState({},null,"/")})).catch((function(){window.location="/"}))}),[t]),Object(n.useEffect)((function(){if(u&&d){var t=setInterval((function(){v.a.post("http://localhost:3001/refresh",{refreshToken:u}).then((function(t){r(t.data.accessToken),h(t.data.expiresIn)})).catch((function(){window.location="/"}))}),1e3*(d-60));return function(){return clearInterval(t)}}}),[u,d]),a}(t.code),c=Object(n.useState)(""),a=Object(s.a)(c,2),r=a[0],i=a[1],u=Object(n.useState)([]),l=Object(s.a)(u,2),f=l[0],b=l[1],d=Object(n.useState)(),h=Object(s.a)(d,2),p=h[0],O=h[1],m=Object(n.useState)(),g=Object(s.a)(m,2),y=g[0],k=g[1],T=Object(n.useState)(),w=Object(s.a)(T,2),E=w[0],A=w[1],C=Object(n.useState)([]),R=Object(s.a)(C,2),M=R[0],N=R[1];function I(t){O(t),function(t){var e=t.uri.split("spotify:track:")[1];_.getAudioAnalysisForTrack(e).then((function(t){k(t.body)})).catch((function(t){console.error(t)}))}(t),function(t){var e=t.uri.split("spotify:track:")[1];_.getAudioFeaturesForTrack(e).then((function(t){A(t.body)})).catch((function(t){console.error(t)}))}(t),i("")}return Object(n.useEffect)((function(){e&&_.setAccessToken(e)}),[e]),Object(n.useEffect)((function(){if(!r)return b([]);if(e){var t=!1;return _.searchTracks(r).then((function(e){t||b(e.body.tracks.items.map((function(t){var e=t.album.images.reduce((function(t,e){return e.height<t.height?e:t}),t.album.images[0]);return{artist:t.artists[0].name,title:t.name,uri:t.uri,albumUrl:e.url}})))})),function(){return t=!0}}}),[r,e]),Object(o.jsx)("div",{className:"dashboard",children:p?Object(o.jsx)(S,{accessToken:e,playingTrack:p,trackAnalysis:y,trackFeatures:E,deselectTrack:function(){O(null),k(null),A(null),M.forEach((function(t){return clearTimeout(t)}))},setTimings:N}):Object(o.jsxs)("div",{children:[Object(o.jsx)(j.a.Control,{type:"search",placeholder:"Search Songs/Artists",value:r,onChange:function(t){return i(t.target.value)}}),Object(o.jsx)("div",{className:"flex-grow-1 my-2",style:{overflowY:"auto"},children:f.map((function(t){return Object(o.jsx)(x,{track:t,chooseTrack:I},t.uri)}))})]})})}c(112);function C(){var t=Object(n.useState)(),e=Object(s.a)(t,2),c=e[0],a=e[1];return Object(n.useEffect)((function(){a((function(){return new URLSearchParams(window.location.search).get("code")}))}),[]),c?Object(o.jsx)(A,{code:c}):Object(o.jsx)(h,{})}r.a.render(Object(o.jsx)(C,{}),document.getElementById("root"))},71:function(t,e){}},[[113,1,2]]]);
//# sourceMappingURL=main.38af9fb1.chunk.js.map